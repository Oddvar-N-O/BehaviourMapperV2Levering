(this.webpackJsonpbehaviour_mapper=this.webpackJsonpbehaviour_mapper||[]).push([[0],{108:function(e,t,n){},109:function(e,t,n){},110:function(e,t,n){},112:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n(2),o=n.n(c),i=n(69),s=n.n(i),r=(n(95),n(27)),l=(n(96),n(75)),d=n(42),h=n(43),u=n(31),p=n(45),j=n(44);var b=function(e){var t=Object(c.useState)(""),n=Object(r.a)(t,2),o=n[0],i=n[1];return Object(c.useEffect)((function(){fetch("getfigure?description=".concat(e.description,"&color=").concat(e.color)).then((function(e){return e.blob()})).then((function(e){var t=URL.createObjectURL(e);i(t)}))}),[e.description,e.color]),Object(a.jsx)(a.Fragment,{children:Object(a.jsx)("img",{id:e.description+" "+e.color,className:"single-icon",alt:"icon",src:o})})},m=(n(97),function(e){Object(p.a)(n,e);var t=Object(j.a)(n);function n(){var e;return Object(d.a)(this,n),(e=t.call(this)).state={color:"blue",icon:"",allIconData:[],redData:[],blueData:[],greenData:[]},e}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=this;fetch("getfiguredata").then((function(e){return e.json()})).then((function(t){e.setState({allIconData:t});for(var n=0;n<e.state.allIconData.length;n++)"red"===e.state.allIconData[n].color?e.state.redData.push(e.state.allIconData[n]):"blue"===e.state.allIconData[n].color?e.state.blueData.push(e.state.allIconData[n]):e.state.greenData.push(e.state.allIconData[n])})),this.handleChange=this.handleChange.bind(this)}},{key:"handleChange",value:function(e){this.setState({color:e.target.value})}},{key:"render",value:function(){var e=this,t=this.state.redData.map((function(t){return Object(a.jsxs)("div",{className:"single-icon",children:[Object(a.jsx)("div",{className:"single-icon",onClick:e.props.selectIcon,children:Object(a.jsx)(b,{description:t.description,color:t.color})}),Object(a.jsx)("div",{className:"icon-description",children:t.description})]},t.id)})),n=this.state.blueData.map((function(t){return Object(a.jsxs)("div",{className:"single-icon",children:[Object(a.jsx)("div",{className:"single-icon",onClick:e.props.selectIcon,children:Object(a.jsx)(b,{description:t.description,color:t.color})}),Object(a.jsx)("div",{className:"icon-description",children:t.description})]},t.id)})),c=this.state.greenData.map((function(t){return Object(a.jsxs)("div",{className:"single-icon",children:[Object(a.jsx)("div",{className:"single-icon",onClick:e.props.selectIcon,children:Object(a.jsx)(b,{description:t.description,color:t.color})}),Object(a.jsx)("div",{className:"icon-description",children:t.description})]},t.id)}));return Object(a.jsxs)("div",{className:"icon-select",children:[Object(a.jsxs)("ul",{className:"gender-select",children:[Object(a.jsx)("li",{onClick:function(){e.setState({color:"blue"})},className:"blue"===this.state.color?"selected":"not-selected",children:"Man"}),Object(a.jsx)("li",{onClick:function(){e.setState({color:"red"})},className:"red"===this.state.color?"selected":"not-selected",children:"Woman"}),Object(a.jsx)("li",{onClick:function(){e.setState({color:"green"})},className:"green"===this.state.color?"selected":"not-selected",children:"Child"})]}),Object(a.jsx)("div",{className:"red"===this.state.color?"icons-visible":"icons-invisible",children:t}),Object(a.jsx)("div",{className:"blue"===this.state.color?"icons-visible":"icons-invisible",children:n}),Object(a.jsx)("div",{className:"green"===this.state.color?"icons-visible":"icons-invisible",children:c})]})}}]),n}(o.a.Component)),f=(n(98),function(e){Object(p.a)(n,e);var t=Object(j.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={background:"https://www.talkwalker.com/images/2020/blog-headers/image-analysis.png",icons:[],ourSRC:null,sendNewIconToBD:!1,newIconID:0,actionID:0,ourIconID:0,ourIconCoord:{x:0,y:0,degree:0},ourMouseCoord:{x:0,y:0},p_id:e.location.state.p_id,projdata:[],mapblob:""},a.selectIcon=a.addIconToList.bind(Object(u.a)(a)),a}return Object(h.a)(n,[{key:"sendDatabaseEvent",value:function(){var e=new FormData,t=[this.state.ourIconCoord.x-25,this.state.ourIconCoord.y-25];void 0===this.state.ourIconCoord.degree&&this.setState({ourIconCoord:{degree:"rotate(0deg)"}}),e.append("direction",this.state.ourIconCoord.degree),e.append("center_coordinate",t),e.append("created",new Date),e.append("f_id",this.state.ourIconID),fetch("http://localhost:5000/addevent",{method:"POST",body:e}).then((function(e){}))}},{key:"updateCoord",value:function(e){this.setState({ourMouseCoord:{x:e.clientX,y:e.clientY}})}},{key:"newIcon",value:function(){this.hideIcon(),this.setState({addIcon:!0})}},{key:"setInnerHTML",value:function(e){if(null!=e){var t=e.split(" ");switch(t[0]=t[0].charAt(0).toUpperCase()+t[0].slice(1),t[1]){case"blue":t[1]="Man";break;case"red":t[1]="Woman";break;default:t[1]="Child"}return t[0]+": "+t[1]}return console.error("Pr\xf8v p\xe5 Nytt")}},{key:"addIconToList",value:function(e){var t=this,n=document.getElementById("iconList"),a=document.createElement("li"),c=e.target.src;this.setState({icons:[].concat(Object(l.a)(this.state.icons),[c])},(function(){})),a.setAttribute("id",c);var o=this.setInnerHTML(e.target.getAttribute("id")),i=this.objectExists(o),s=this.alreadyInList(o,n);!1===s&&!0===i?(a.innerHTML=o,a.addEventListener("click",(function(){t.setState({ourSRC:a.getAttribute("id")},(function(){})),t.hideIcon()})),this.setState({ourSRC:c},(function(){})),this.hideIcon(),n.appendChild(a),this.setState({imgIcon:a.getAttribute("id")}),this.closeIconSelect()):!1===s&&!1===i?(alert("Error Loading from DB, please try again!"),this.closeIconSelect()):(alert("This icon already exists in the list!"),this.closeIconSelect())}},{key:"objectExists",value:function(e){return void 0!==e||(console.log("undefined!"),!1)}},{key:"alreadyInList",value:function(e,t){for(var n=t.getElementsByTagName("li"),a=0;a<n.length;a++)if(n[a].innerHTML===e)return!0;return!1}},{key:"takeAction",value:function(e){null!==this.state.ourSRC&&!1===this.state.addIcon&&(0===this.state.actionID?(this.placeIcon(e),this.setState({sendNewIconToBD:!0},(function(){})),this.startPointing()):this.pointIcon())}},{key:"placeIcon",value:function(e){var t=document.createElement("img");t.src=this.state.ourSRC,t.classList.add("icon"),t.setAttribute("id",this.state.newIconID.toString()),this.setState({ourIconID:this.state.newIconID}),this.setState({newIconID:this.state.newIconID+1}),document.getElementById("iconContainer").appendChild(t),t.style.top=e.clientY+"px",t.style.left=e.clientX+"px";var n=e.clientX,a=e.clientY;this.setState({ourIconCoord:{x:n,y:a}})}},{key:"pointIcon",value:function(){var e=180*Math.atan2(this.state.ourMouseCoord.x-this.state.ourIconCoord.x,-(this.state.ourMouseCoord.y-this.state.ourIconCoord.y))/Math.PI-90,t="rotate("+Math.round(e).toString()+"deg)";this.setState({ourIconCoord:{x:this.state.ourIconCoord.x,y:this.state.ourIconCoord.y,degree:t}});var n=document.getElementById(this.state.ourIconID.toString());null!=t&&(n.style.transform=t)}},{key:"startPointing",value:function(){this.setState({actionID:1})}},{key:"stopPointing",value:function(){this.setState({actionID:0}),this.state.sendNewIconToBD&&(this.sendDatabaseEvent(),this.setState({sendNewIconToBD:!1},(function(){})))}},{key:"hideIcon",value:function(){var e=document.getElementById(this.state.ourIconID.toString());null!=e&&(e.style.display="none"),this.stopPointing()}},{key:"showAll",value:function(){this.stopPointing();for(var e=0;e<this.state.newIconID;e++)document.getElementById(e.toString()).style.display="block"}},{key:"hideAll",value:function(){this.stopPointing();for(var e=0;e<this.state.newIconID;e++)document.getElementById(e.toString()).style.display="none"}},{key:"closeIconSelect",value:function(){this.setState({addIcon:!1})}},{key:"componentDidMount",value:function(){var e=this;fetch("getprojectmapping?p_id=".concat(this.state.p_id)).then((function(e){return e.json()})).then((function(t){e.setState({projdata:t})})),fetch("getmap?p_id=".concat(this.state.p_id)).then((function(e){return e.blob()})).then((function(t){var n=URL.createObjectURL(t);e.setState({mapblob:n})}))}},{key:"render",value:function(){var e=this;return Object(a.jsxs)("div",{id:"maincont",children:[Object(a.jsxs)("div",{className:"sidebar",children:[Object(a.jsxs)("div",{className:this.state.addIcon?"visible":"icons-invisible",children:[Object(a.jsx)(m,{selectIcon:this.selectIcon}),Object(a.jsx)("button",{id:"exitIconSelect",onClick:function(){return e.closeIconSelect()},children:"Return"})]}),Object(a.jsxs)("ul",{id:"iconList",children:[Object(a.jsx)("li",{className:"buttonLi",onClick:function(){return e.newIcon()},children:"Add Event"}),Object(a.jsx)("li",{className:"buttonLi",onClick:function(){return e.showAll()},children:"Show icons"}),Object(a.jsx)("li",{className:"buttonLi",onClick:function(){return e.hideAll()},children:"Hide icons"})]})]}),Object(a.jsx)("img",{alt:"",onMouseMove:function(t){return e.updateCoord(t)},onClick:function(t){return e.takeAction(t)},className:"map-image",src:this.state.mapblob}),Object(a.jsx)("div",{id:"iconContainer"})]})}}]),n}(o.a.Component)),g=n(70),v=(n(99),n(25)),O=n(53),x=function(e){Object(p.a)(n,e);var t=Object(j.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={projectName:"",projectNameLegend:"Project Name",projectImageLegend:"Image",description:"",redirect:!1,fromLoadMap:e.location.state.fromLoadMap,liColor:"#F3F7F0",p_id:""},a.handleChange=a.handleChange.bind(Object(u.a)(a)),a.handleUploadImage=a.handleUploadImage.bind(Object(u.a)(a)),a.setRedirect=a.setRedirect.bind(Object(u.a)(a)),a.imageChosen=a.imageChosen.bind(Object(u.a)(a)),a.redirectToMapping=a.redirectToMapping.bind(Object(u.a)(a)),a}return Object(h.a)(n,[{key:"handleChange",value:function(e){var t=this,n=e.target,a=n.name,c=n.value;this.setState(Object(g.a)({},a,c)),"Project Name Required"===this.state.projectNameLegend&&"project-name"===e.target.id&&this.setState({projectNameLegend:"Project Name"},(function(){t.changeColor()}))}},{key:"imageChosen",value:function(){var e=this;"Image Required"===this.state.projectImageLegend&&this.setState({projectImageLegend:"Image"},(function(){e.changeColor()}))}},{key:"changeColor",value:function(){"#F3F7F0"===this.state.liColor?this.setState({liColor:"#FF0000"}):"Project Name"===this.state.projectNameLegend&&this.setState({liColor:"#F3F7F0"})}},{key:"handleUploadImage",value:function(e){var t=this,n=new FormData;n.append("file",this.uploadInput.files[0]),n.append("p_id",e),fetch("http://localhost:5000/upload",{method:"POST",body:n}).then(setTimeout((function(){return t.redirectToMapping()}),500))}},{key:"redirectToMapping",value:function(){this.props.history.push({pathname:"/mapping",state:{p_id:this.state.p_id}})}},{key:"setRedirect",value:function(e){e.preventDefault(),this.state.fromLoadMap?""!==this.state.projectName&&0!==this.uploadInput.files.length?this.handleRedirect():(""===this.state.projectName&&this.setState({projectNameLegend:"Project Name Required"}),0===this.uploadInput.files.length&&this.setState({projectImageLegend:"Image Required"}),this.changeColor()):""!==this.state.projectName?this.handleRedirect():(this.setState({projectNameLegend:"Project Name Required"}),this.changeColor())}},{key:"handleRedirect",value:function(){var e=this,t=new FormData;t.append("name",this.state.projectName),t.append("description",this.state.description),t.append("startdate",new Date),this.state.fromLoadMap&&t.append("map",this.uploadInput.files[0].name),fetch("addproject",{method:"POST",body:t}).then((function(t){t.json().then((function(t){e.setState({p_id:t.p_id[0]}),e.state.fromLoadMap?e.handleUploadImage(t.p_id[0]):e.props.history.push({pathname:"/chooseImage",state:{projectName:e.state.projectName,description:e.state.description,p_id:t.p_id[0]}})}))}))}},{key:"render",value:function(){var e=this;return Object(a.jsx)("div",{id:"new-project",children:Object(a.jsxs)("div",{className:this.state.fromLoadMap?"new-project-box-upload":"new-project-box",children:[Object(a.jsx)(v.b,{to:"/startpage",className:"close-icon",children:Object(a.jsx)(O.a,{})}),Object(a.jsxs)("div",{id:"heading-and-form",children:[Object(a.jsxs)("h2",{children:["New Project ",this.state.fromLoadMpap]}),Object(a.jsxs)("form",{children:[Object(a.jsx)("legend",{children:this.state.projectNameLegend}),Object(a.jsx)("input",{id:"project-name",type:"text",name:"projectName",value:this.state.projectName,onChange:this.handleChange}),Object(a.jsx)("br",{}),Object(a.jsx)("legend",{children:"Description"}),Object(a.jsx)("textarea",{id:"description",name:"description",value:this.state.description,placeholder:"E.g. time of day, wheather conditions, special events etc.",onChange:this.handleChange})]})]}),Object(a.jsxs)("form",{className:this.state.fromLoadMap?"file-management":"hide-file-management",children:[Object(a.jsx)("legend",{children:this.state.projectImageLegend}),Object(a.jsx)("input",{ref:function(t){e.uploadInput=t},type:"file",className:"file-button",onChange:this.imageChosen})]}),Object(a.jsx)("ul",{children:Object(a.jsx)("li",{onClick:function(t){e.setRedirect(t)},style:{backgroundColor:this.state.liColor},children:"Let's go!"})})]})})}}]),n}(o.a.Component);var I=function(){var e=Object(c.useState)("Prosjektet finnes ikke."),t=Object(r.a)(e,2),n=t[0],o=t[1];return Object(c.useEffect)((function(){fetch("getfigure?description=bike&color=".concat("green")).then((function(e){return e.blob()})).then((function(e){var t=URL.createObjectURL(e);document.getElementById("figur").src=t}))}),[]),Object(c.useEffect)((function(){fetch("getproject?u_id=1&name=prosjektnamn").then((function(e){return e.json()})).then((function(e){o(e)}))}),[]),Object(a.jsxs)("div",{className:"login",children:[Object(a.jsx)(v.b,{to:"/startpage",children:Object(a.jsx)("img",{alt:"en figur",id:"figur"})}),n]})};n(108);var y=function(){var e=Object(c.useState)(!1),t=Object(r.a)(e,2),n=t[0],o=t[1],i=function(){return o(!1)},s=Object(c.useState)(!1),l=Object(r.a)(s,2),d=l[0],h=l[1];return Object(a.jsxs)("div",{className:"startpage",children:[Object(a.jsx)("h1",{children:"Behaviour Mapper"}),Object(a.jsxs)("ul",{id:"start-menu",children:[Object(a.jsx)("li",{onClick:function(){h(!1),o(!n)},className:n?"active":"passive",children:"New Project"}),Object(a.jsx)("li",{onClick:function(){i(),h(!d)},className:d?"active":"passive",children:Object(a.jsx)(v.b,{to:"/loadproject",children:"Load Project"})}),Object(a.jsx)("li",{onClick:i,children:"User Profile"})]}),Object(a.jsxs)("ul",{id:n?"load-map":"invisible",children:[Object(a.jsx)(v.b,{to:{pathname:"/newproject",state:{fromLoadMap:!1}},children:Object(a.jsx)("li",{children:"Use Web-map"})}),Object(a.jsx)(v.b,{to:{pathname:"/newproject",state:{fromLoadMap:!0}},children:Object(a.jsx)("li",{children:"Load Map From File"})})]})]})},C=n(72),N=n(64),S=n(74),k=n(73),D=n(51),w=n(8),L=(n(109),function(e){Object(p.a)(n,e);var t=Object(j.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={projectName:e.location.state.projectName,description:e.location.state.description,p_id:e.location.state.p_id},a.map=new C.a({target:null,layers:[new S.a({source:new k.a})],view:new N.a({center:Object(w.l)([5.733107,58.969975],"EPSG:4326","EPSG:3857"),zoom:12}),controls:[new D.a]}),a.exportImg=a.exportImg.bind(Object(u.a)(a)),a.pauseBeforeRedirect=a.pauseBeforeRedirect.bind(Object(u.a)(a)),a}return Object(h.a)(n,[{key:"exportImg",value:function(){var e=this,t=document.createElement("canvas"),n=this.map.getSize();t.width=n[0],t.height=n[1];var a=t.getContext("2d");Array.prototype.forEach.call(document.querySelectorAll(".ol-layer canvas"),(function(e){if(e.width>0){var t=e.parentNode.style.opacity;a.globalAlpha=""===t?1:Number(t);var n=e.style.transform.match(/^matrix([^]*)$/)[1].split(",").map(Number);CanvasRenderingContext2D.prototype.setTransform.apply(a,n),a.drawImage(e,0,0)}})),fetch(t.toDataURL()).then((function(e){return e.blob()})).then((function(t){t.lastModifiedDate=new Date,t.name=e.state.projectName+".png";var n=new File([t],t.name,{lastModified:(new Date).getTime(),type:t.type}),a=new FormData;a.append("file",n),a.append("p_id",e.state.p_id),fetch("http://localhost:5000/upload",{method:"POST",body:a}).then(setTimeout((function(){return e.pauseBeforeRedirect()}),500))}))}},{key:"pauseBeforeRedirect",value:function(){this.props.history.push({pathname:"/mapping",state:{p_id:this.state.p_id}})}},{key:"componentDidMount",value:function(){var e=this;this.map.setTarget("choose-image-map"),this.map.on("moveend",(function(){var t=e.map.getView().getCenter(),n=e.map.getView().getZoom();e.setState({center:t,zoom:n})}))}},{key:"render",value:function(){return Object(a.jsx)("div",{id:"choose-image",children:Object(a.jsxs)("div",{className:"choose-image-box",children:[Object(a.jsx)("h1",{children:this.state.projectName}),Object(a.jsx)(v.b,{to:"/startpage",className:"close-icon",children:Object(a.jsx)(O.a,{})}),Object(a.jsx)("div",{id:"choose-image-map"}),Object(a.jsx)("button",{className:"choose-image-button",onClick:this.exportImg,children:"Choose image"})]})})}}]),n}(o.a.Component)),M=n(17);var E=function(e){var t=[];if("No projects found"!==e.projects)for(var n=0;n<e.projects.length;n++)t.push(Object(a.jsx)("li",{className:"projectName",onClick:function(t){e.getCurrProj(t.target.innerHTML)},children:e.projects[n][1]},e.projects[n][0]));return Object(a.jsx)("div",{className:"sidebarLP",children:Object(a.jsx)("ul",{children:t})})};n(110);var R=function(){var e=Object(c.useState)("No projects found"),t=Object(r.a)(e,2),n=t[0],o=t[1],i=Object(c.useState)("No event for this project"),s=Object(r.a)(i,2),l=s[0],d=s[1],h=Object(c.useState)({id:99999999999999999n}),u=Object(r.a)(h,2),p=u[0],j=u[1],b=Object(c.useState)(!1),m=Object(r.a)(b,2),f=m[0],g=m[1];return Object(c.useEffect)((function(){var e="getproject?u_id=".concat(1);fetch(e).then((function(e){return e.json()})).then((function(e){o(e)}))}),[]),Object(c.useEffect)((function(){var e="getevents?p_id=".concat(p.id);fetch(e).then((function(e){return e.json()})).then((function(e){"Bad arg"!==e.message&&d(e)}))}),[p]),Object(a.jsx)("div",{id:"load-project",children:Object(a.jsxs)("div",{className:"load-project-box",children:[Object(a.jsx)(v.b,{to:"/startpage",className:"close-icon",children:Object(a.jsx)(O.a,{})}),Object(a.jsx)(E,{getCurrProj:function(e){for(var t=0;t<n.length;t++)n[t][1]===e&&(g(!0),j({id:n[t][0],name:n[t][1],description:n[t][2],map:n[t][3],screenshot:n[t][4],startdate:n[t][5],enddate:n[t][6],zoom:n[t][7],u_id:n[t][8]}))},projects:n}),Object(a.jsxs)("div",{className:f?"show-project-list":"hide-project-list",children:[Object(a.jsxs)("h1",{children:["Description: ",p.description]}),Object(a.jsxs)("p",{children:["Project id: ",p.id," Name: ",p.name," Screenshot: ",p.screenshot," Events: ",l]}),Object(a.jsx)("img",{alt:"Screenshot av kartet til "+p.name+".",id:"opplastetKart"}),Object(a.jsx)("button",{children:Object(a.jsx)(v.b,{to:{pathname:"/mapping",data:{project:p,events:{allEvents:l}},state:{p_id:p.id}},children:"Choose this project"})})]})]})})};var _=function(){var e=Object(c.useState)("Flask server not running"),t=Object(r.a)(e,2),n=t[0],o=t[1];return Object(c.useEffect)((function(){fetch("/hello").then((function(e){return e.json()})).then((function(e){o(e.result)}))}),[]),Object(a.jsxs)("div",{className:"App",children:[Object(a.jsx)("header",{className:"App-header",children:Object(a.jsxs)("p",{children:["Flask says ",n]})}),Object(a.jsx)(v.a,{children:Object(a.jsxs)(M.c,{children:[Object(a.jsx)(M.a,{path:"/",exact:!0,component:I}),Object(a.jsx)(M.a,{path:"/startpage",component:y}),Object(a.jsx)(M.a,{path:"/newproject",component:x}),Object(a.jsx)(M.a,{path:"/chooseImage",component:L}),Object(a.jsx)(M.a,{path:"/mapping",component:f}),Object(a.jsx)(M.a,{path:"/loadproject",component:R})]})})]})};n(111);s.a.render(Object(a.jsx)(o.a.StrictMode,{children:Object(a.jsx)(_,{})}),document.getElementById("root"))},95:function(e,t,n){},96:function(e,t,n){},97:function(e,t,n){},98:function(e,t,n){},99:function(e,t,n){}},[[112,1,2]]]);
//# sourceMappingURL=main.d9518129.chunk.js.map